# 当前进度（成员B）

**日期**：2026-01-20

## 一、已完成（成员B 已实现）
- 完成增量对比核心逻辑与 LLM 接入框架：`codes/incremental_analysis.py`
  - 包含 Prompt 模板、LLM 调用、JSON 解析、异常兜底与启发式回退。
  - 修复了 N/A 值处理与字段附近精确提取（例如“利用率”优先提取“利用率为 80%”附近的百分比）。
- 完成冲突仲裁逻辑：`codes/conflict_resolution.py`
  - 按来源权重选择最终结论（官方 > 媒体 > 传闻）。
- 定义数据模型与权重：`codes/models.py`
- 编写了本地调试脚本：`codes/mock_test_b.py`（用于验证增量提取与仲裁流程）
- 更新并适配触发入口以支持阿里云 FC：`codes/trigger_layer.py`
  - 入口 `handler(event, context)` 支持 bytes/str/dict payload，返回 JSON 摘要。
- 制作 Serverless Devs 部署模板：`s.yaml`（阿里云 FC 示例，可用 `s deploy` 部署）
- 补充并修订 README、逐步完善清单等文档文件。

## 二、当前代码位置（重要文件）
- `codes/trigger_layer.py` — FC 入口
- `codes/scraper_layer.py` — 采集层（当前为占位 mock）
- `codes/storage_layer.py` — 存储层（当前为本地文件模拟）
- `codes/incremental_analysis.py` — 增量对比（含 LLM 调用与兜底）
- `codes/conflict_resolution.py` — 冲突仲裁
- `codes/orchestrator.py` — 主流程编排（采集→对比→仲裁→存储）
- `codes/mock_test_b.py` — 本地测试脚本

## 三、剩余待办（需要成员 A / C 协作完成）

### 成员 A（架构 / Ops）
- 将 `storage_layer.py` 替换为 OSS 实现（读取最新快照并写回 JSON），并在 FC 中配置 OSS 权限（RAM / AccessKey）。
- 在阿里云 FC 控制台或 `s.yaml` 中配置环境变量：`SILICONFLOW_API_KEY`（LLM Key）、OSS 凭据（若不使用 RAM 角色）。
- 部署 `s.yaml`，配置定时触发器（Cron）并完成一次触发测试。
- 配置日志与告警（SLS、钉钉/邮件通知）。

### 成员 C（数据 / 报告）
- 实现 `codes/scraper_layer.py`：对接真实数据源（新闻 API、雪球、巨潮等），实现去重与重试策略。
- 实现 `reporter.py`（或在 `orchestrator` 中扩展）：将变更结果渲染为 Markdown 报告并高亮增/降（用于展示或邮件推送）。

## 四、已知问题与建议
- 目前 `storage_layer.py` 使用本地文件作为持久化，需尽快迁移到 OSS，否则 FC 重启会丢失历史快照。
- LLM API Key 与网络访问需要成员 A 在 FC 环境中验证连通性（内部网络策略可能阻止外网访问）。
- 建议成员 A 将常用依赖打成 Layer（例如 `langchain`、`requests`）以缩短冷启动时间。

## 五、下一步建议（优先级）
1. 成员 A：实现 OSS 版本的 `storage_layer.py` 并在测试环境部署（高优先级）。
2. 成员 C：接入至少一个稳定的新闻 API，完成 `scraper_layer.py`（中优先级）。
3. 成员 B（我）：如需，可将 `storage_layer.py` 提供一个 OSS 示例实现（占位代码）。

---

若你希望我把 `storage_layer.py` 直接改为 OSS 示例实现或把部署文档写成更详细的步骤（含最小权限示例），回复“请生成 OSS 实现”或“生成详细部署文档”。
